import { defineEventHandler } from "h3";
import { useSitemapRuntimeConfig } from "../../utils.js";
import {
  childSitemapSources,
  globalSitemapSources,
  resolveSitemapSources
} from "../../sitemap/urlset/sources.js";
import { useNitroOrigin } from "#site-config/server/composables/useNitroOrigin";
export default defineEventHandler(async (e) => {
  const _runtimeConfig = useSitemapRuntimeConfig();
  const { sitemaps: _sitemaps } = _runtimeConfig;
  const runtimeConfig = { ..._runtimeConfig };
  delete runtimeConfig.sitemaps;
  const globalSources = await globalSitemapSources();
  const nitroOrigin = useNitroOrigin(e);
  const sitemaps = {};
  for (const s of Object.keys(_sitemaps)) {
    sitemaps[s] = {
      ..._sitemaps[s],
      sources: await resolveSitemapSources(await childSitemapSources(_sitemaps[s]), e)
    };
  }
  return {
    nitroOrigin,
    sitemaps,
    runtimeConfig,
    globalSources: await resolveSitemapSources(globalSources, e)
  };
});
